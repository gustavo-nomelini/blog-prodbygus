---
import { getCollection } from 'astro:content';
import BlogCategoryFilter from '../../components/BlogCategoryFilter.astro';
import PostCard from '../../components/PostCard.astro';
import Layout from '../../layouts/Layout.astro';

// Check if there's a category query parameter and redirect to the dedicated route
const url = Astro.url;
const categoryParam = url.searchParams.get('category');

if (categoryParam) {
	return Astro.redirect(`/category/${categoryParam}`);
}

// Get all posts
let posts = (await getCollection('blog'))
	.filter(post => !post.data.draft)
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<Layout title="Posts | PRODBYGUS" description="Compartilhando conhecimento e experiências no mundo da tecnologia.">
	<section class="section-padding">
		<div class="mx-auto max-w-4xl">
			<h1 class="text-gradient mb-8 text-4xl md:text-5xl lg:text-6xl font-bold tracking-tight">
				Posts
			</h1>
			<p class="text-xl mb-10">
				Compartilhando conhecimento e experiências no mundo da tecnologia.
			</p>
			
			<!-- Category Filter -->
			<BlogCategoryFilter activeCategory={undefined} />
		</div>
	</section>

	<section class="mb-16">
		<div class="mx-auto max-w-7xl px-4 lg:px-8">
			<div class="mx-auto max-w-4xl lg:max-w-6xl">
				{posts.length === 0 && (
					<div class="text-center py-12">
						<h2 class="text-xl font-medium mb-4">Nenhum post encontrado</h2>
						<p class="text-[var(--text-muted)]">Não há posts disponíveis no momento.</p>
					</div>
				)}
				
				<div class="mt-12 space-y-16">
					{posts.map((post) => (
						<PostCard post={post} variant="list" />
					))}
				</div>
			</div>
		</div>
	</section>
</Layout>
