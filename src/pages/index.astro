---
import { getCollection } from 'astro:content';
import FormattedDate from '../components/FormattedDate.astro';
import Layout from '../layouts/Layout.astro';

// Fetch the 3 latest blog posts
const posts = (await getCollection('blog'))
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
	.slice(0, 3);
---

<Layout title="PRODBYGUS">
	<section class="section-padding">
		<div class="max-w-4xl mx-auto">
			<h1 class="text-gradient mb-8 text-4xl md:text-5xl lg:text-6xl font-bold tracking-tight">
				Bem-vindo ao <span class="block">PRODBYGUS</span>
			</h1>
			
			<div class="animate-fade-in">
				<p class="text-xl mb-6">
					Compartilhando ideias, projetos e experiências no mundo da tecnologia e desenvolvimento.
				</p>
				
				<div class="flex flex-wrap gap-4 mt-8">
					<a href="/blog" class="btn-primary">
						Ver posts
					</a>
					<a href="/about" class="btn-outline">
						Sobre mim
					</a>
				</div>
			</div>
		</div>
	</section>
	
	<section class="section-padding bg-surface-50 backdrop-blur-sm rounded-lg">
		<div class="mx-auto max-w-7xl px-6 lg:px-8">
			<div class="mx-auto max-w-2xl text-center">
				<h2 class="text-balance text-4xl font-semibold tracking-tight mb-3">Últimos Posts</h2>
				<p class="mt-2 text-lg/8 text-[var(--text-muted)]">Compartilhando conhecimento e experiências no mundo da tecnologia.</p>
			</div>
			
			{posts.length > 0 ? (
				<div class="mx-auto mt-16 grid max-w-2xl grid-cols-1 gap-x-8 gap-y-12 lg:mx-0 lg:max-w-none lg:grid-cols-3">
					{posts.map((post) => (
						<article class="card group hover:bg-surface-10 hover:shadow-lg hover:shadow-[var(--primary)]/10 transition-all duration-300">
							<div class="relative flex flex-col">
								<div class="relative aspect-video">
									<img 
										src={post.data.heroImage || '/blog-placeholder-1.jpg'} 
										alt={post.data.title} 
										class="size-full rounded-lg bg-[var(--surface)] object-cover"
									/>
									<div class="absolute inset-0 rounded-lg ring-1 ring-inset ring-[var(--primary)]/20"></div>
								</div>
								<div class="mt-6">
									<div class="flex items-center gap-x-4 text-xs">
										<span class="text-[var(--text-muted)]">
											<FormattedDate date={post.data.pubDate} />
										</span>
										{post.data.category && (
											<a 
												href={`/blog/category/${post.data.category}`} 
												class="relative z-10 rounded-full bg-[var(--surface)] px-3 py-1.5 font-medium text-[var(--text)] hover:bg-[var(--primary)] hover:text-[var(--background)] transition-colors"
											>
												{post.data.category}
											</a>
										)}
									</div>
									<div class="group relative max-w-xl">
										<h3 class="mt-3 text-lg/6 font-semibold text-[var(--text)] group-hover:text-[var(--primary)] transition-colors">
											<a href={`/blog/${post.slug}/`}>
												<span class="absolute inset-0"></span>
												{post.data.title}
											</a>
										</h3>
										<p class="mt-4 line-clamp-3 text-sm/6 text-[var(--text-muted)]">{post.data.description}</p>
									</div>
									<div class="mt-6 pt-4 border-t border-[var(--primary)]/10">
										<div class="relative flex items-center gap-x-4">
											<img src="/avatar.jpg" alt="Gustavo Lopes Nomelini" class="size-10 rounded-full bg-[var(--surface)]" />
											<div class="text-sm/6">
												<p class="font-semibold text-[var(--text)]">
													<a href="/about">
														<span class="absolute inset-0"></span>
														{post.data.author || "Gustavo Lopes Nomelini"}
													</a>
												</p>
												<p class="text-[var(--text-muted)]">Desenvolvedor Full Stack</p>
											</div>
										</div>
									</div>
								</div>
							</div>
						</article>
					))}
				</div>
			) : (
				<div class="mx-auto mt-16 text-center">
					<p class="text-[var(--text-muted)]">Nenhum post encontrado.</p>
				</div>
			)}
			
			<div class="text-center mt-12">
				<a href="/blog" class="btn-primary">
					Ver todos os posts
				</a>
			</div>
		</div>
	</section>
	
	<section class="section-padding bg-surface-50 backdrop-blur-sm rounded-lg my-12">
		<div class="max-w-3xl mx-auto text-center">
			<h2 class="mb-6">Entre em Contato</h2>
			<p class="mb-8">
				Tem uma ideia, projeto ou apenas quer trocar uma ideia? Entre em contato comigo!
			</p>
			<a href="/contact" class="btn-primary">
				Enviar mensagem
			</a>
		</div>
	</section>
</Layout>
